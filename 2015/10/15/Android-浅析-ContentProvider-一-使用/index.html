<!DOCTYPE html>


  <html class="light page-post">


<head>
  <meta charset="utf-8">
  
  <title>Android 浅析 ContentProvider (一) 使用 | Zhong&#39;s_blog</title>

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
    <meta name="keywords" content="Android,Android_基础知识,ContentProvider," />
  

  <meta name="description" content="Android ContentProvider 是 android 四大组件之一，为应用程序提供内容。他们封装数据并通过ContentResolver接口提供给应用程序。如果需要在多个应用程序之间共享数据，则只需要一个内容提供程序。如果你不需要共享数据在多个应用程序，你可以使用一个数据库，直接通过SQLite数据库。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 浅析 ContentProvider (一) 使用">
<meta property="og:url" content="http://yoursite.com/2015/10/15/Android-浅析-ContentProvider-一-使用/index.html">
<meta property="og:site_name" content="Zhong's_blog">
<meta property="og:description" content="Android ContentProvider 是 android 四大组件之一，为应用程序提供内容。他们封装数据并通过ContentResolver接口提供给应用程序。如果需要在多个应用程序之间共享数据，则只需要一个内容提供程序。如果你不需要共享数据在多个应用程序，你可以使用一个数据库，直接通过SQLite数据库。">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/7669bef3gw1exccy7p7lzj20l00bxwg9.jpg">
<meta property="og:updated_time" content="2016-09-22T08:02:10.119Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 浅析 ContentProvider (一) 使用">
<meta name="twitter:description" content="Android ContentProvider 是 android 四大组件之一，为应用程序提供内容。他们封装数据并通过ContentResolver接口提供给应用程序。如果需要在多个应用程序之间共享数据，则只需要一个内容提供程序。如果你不需要共享数据在多个应用程序，你可以使用一个数据库，直接通过SQLite数据库。">
<meta name="twitter:image" content="http://ww4.sinaimg.cn/large/7669bef3gw1exccy7p7lzj20l00bxwg9.jpg">

  

  
    <link rel="icon" href="/favicon.ico">
  

  <link href="/css/styles.css?v=028c63b1" rel="stylesheet">


  
    <link rel="stylesheet" href="/css/personal-style.css">
  

  

  
  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?57e94d016e201fba3603a8a2b0263af0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>


</head>

<body>


  
    <span id="toolbox-mobile" class="toolbox-mobile">Tag</span>
  

  <div class="post-header CENTER">
   
  <div class="toolbox">
    <a class="toolbox-entry" href="/">
      <span class="toolbox-entry-text">Tag</span>
      <i class="icon-angle-down"></i>
      <i class="icon-home"></i>
    </a>
    <ul class="list-toolbox">
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/archives/"
            rel="noopener noreferrer"
            target="_self"
            >
            Blog
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/tags/"
            rel="noopener noreferrer"
            target="_self"
            >
            Tag
          </a>
        </li>
      
        <li class="item-toolbox">
          <a
            class="CIRCLE"
            href="/about/"
            rel="noopener noreferrer"
            target="_self"
            >
            About
          </a>
        </li>
      
    </ul>
  </div>


</div>


  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts List</strong>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#前言"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#概括"><span class="toc-text">概括</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#组件使用"><span class="toc-text">组件使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#功能简述"><span class="toc-text">功能简述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#代码例子"><span class="toc-text">代码例子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Provider-最主要的六个方法。"><span class="toc-text">Provider 最主要的六个方法。</span></a></li></ol></li></ol></li></ol>
  </div>



<div class="content content-post CENTER">
   <article id="post-Android-浅析-ContentProvider-一-使用" class="article article-type-post" itemprop="blogPost">
  <header class="article-header">
    <h1 class="post-title">Android 浅析 ContentProvider (一) 使用</h1>

    <div class="article-meta">
      <span>
        <i class="icon-calendar"></i>
        <span>2015.10.15</span>
      </span>

      
        <span class="article-author">
          <i class="icon-user"></i>
          <span>钟华健</span>
        </span>
      

      


      
        <span>
          <i class="icon-comment"></i>
          <a href="https://github.com/jasonzhong/2015/10/15/Android-浅析-ContentProvider-一-使用/#disqus_thread"></a>
        </span>
      

    </div>
  </header>

  <div class="article-content">
    
      <a id="more"></a>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>Linus Benedict Torvalds : RTFSC – Read The Funning Source Code</p>
</blockquote>
<h2 id="概括"><a href="#概括" class="headerlink" title="概括"></a>概括</h2><blockquote>
<p>Content providers are one of the primary building blocks of Android applications, providing content to applications. They encapsulate data and provide it to applications through the single ContentResolver interface. A content provider is only required if you need to share data between multiple applications. For example, the contacts data is used by multiple applications and must be stored in a content provider. If you don’t need to share data amongst multiple applications you can use a database directly via SQLiteDatabase.</p>
</blockquote>
<p>我们先来看一张图片让我们对Content Provider有一个直观的了解：<br><img src="http://ww4.sinaimg.cn/large/7669bef3gw1exccy7p7lzj20l00bxwg9.jpg" alt="Content Provider"></p>
<p>ContentProvider提供了在应用程序之前共享数据的一种机制。<br>1、存储和获取数据提供了统一的接口。<br>2、对数据进行封装，不用关心数据存储的细节。<br>3、Android为常见的一些数据提供了默认的ContentProvider(包括音频、视频、图片和通讯录等)。<br>最主要的是ContentProvider对外共享数据统一了数据的访问方式。</p>
<h2 id="组件使用"><a href="#组件使用" class="headerlink" title="组件使用"></a>组件使用</h2><p>首先来看下如何实现一个ContentProvider功能：</p>
<h3 id="功能简述"><a href="#功能简述" class="headerlink" title="功能简述"></a>功能简述</h3><p>服务端：<br>有六个最主要的方法需要重写：<br>1、<strong>onCreate()</strong> which is called to initialize the provider.<br>2、<strong>query(Uri, String[], String, String[], String)</strong> which returns data to the caller.<br>3、<strong>insert(Uri, ContentValues)</strong> which inserts new data into the content provider.<br>4、<strong>update(Uri, ContentValues, String, String[])</strong> which updates existing data in the content provider.<br>5、<strong>delete(Uri, String, String[])</strong> which deletes data from the content provider.<br>6、<strong>getType(Uri)</strong> which returns the MIME type of data in the content provider.<br>注意：<br>insert()和update()方法有可能被多线程调用，一定要是线程安全的。<br>onCreate()方法只会调用一次，但要避免冗长的操作。</p>
<p>客户端：<br>通过<strong>ContentResolver</strong>可以自动获取Provider的实例，不必担心跨进程调用的细节。</p>
<h3 id="代码例子"><a href="#代码例子" class="headerlink" title="代码例子"></a>代码例子</h3><p>服务端：<br>AndroidManifest.xml<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;!-- android:exported="true" 指示该服务是否能够被其他应用程序组件调用或跟它交互。 --&gt;</div><div class="line">&lt;provider</div><div class="line">    android:name="com.unknow.jason.testdatabaseex.DatabaseProvider"</div><div class="line">    android:authorities="com.unknow.jason.testdatabaseex.provider"</div><div class="line">    android:exported="true"</div><div class="line">    android:enabled="true" &gt;</div><div class="line">&lt;/provider&gt;</div></pre></td></tr></table></figure></p>
<p>浅析：<br>AndroidManifest添加provider服务，在安装App的时候会自动注册这个Provider服务到AMS里作备份，这个服务最关键的点是<strong>authorities</strong>，作为Provider唯一标识，让其它程序可以在AMS里面查询到此Provider服务。<br>ps.更多关于Provider的权限可以看<a href="http://developer.android.com/guide/topics/manifest/provider-element.html。" target="_blank" rel="external">http://developer.android.com/guide/topics/manifest/provider-element.html。</a></p>
<p>DatabaseProvider.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DatabaseProvider</span> <span class="keyword">extends</span> <span class="title">ContentProvider</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Cursor <span class="title">query</span><span class="params">(Uri uri, String[] projection, String selection, String[] selectionArgs,</span></span></div><div class="line">                        String sortOrder) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Uri <span class="title">insert</span><span class="params">(Uri uri, ContentValues values)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">update</span><span class="params">(Uri uri, ContentValues values, String selection, String[] selectionArgs)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">delete</span><span class="params">(Uri uri, String selection, String[] selectionArgs)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">(Uri uri)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>浅析：</p>
<h4 id="Provider-最主要的六个方法。"><a href="#Provider-最主要的六个方法。" class="headerlink" title="Provider 最主要的六个方法。"></a>Provider 最主要的六个方法。</h4><p>getType():<br>Implement this to handle requests for the MIME type of the data at the given URI. The returned MIME type should start with <strong>vnd.android.cursor.item for a single record, or vnd.android.cursor.dir/ for multiple items.</strong><br><em>注意: 这方法有可能用于多线程。用于访问此信息的应用程序不需要权限；如果您的内容提供者需要读和/或写权限，或不导出，所有应用程序都可以调用此方法，不管其访问权限。这使他们能够检索URI的MIME类型时，调度意图。</em></p>
<p>insert():<br>Implement this to handle requests to insert a new row. As a courtesy, call notifyChange() after inserting.<br><em>注意: 这方法有可能用于多线程。</em></p>
<p>onCreate():<br>Implement this to initialize your content provider on startup. This method is called for all registered content providers on the application main thread at application launch time. <strong>It must not perform lengthy operations, or application startup will be delayed.</strong><br><em>注意： 如果你使用SQLite进行数据库操作，切勿在此方法中调用getReadableDatabase() or getWritableDatabase()方法，作为代替，可以使用onOpen(SQLiteDatabase)作为第一次初始数据库。</em></p>
<p>query():<br>Implement this to handle query requests from clients.<br><em>注意: 这方法有可能用于多线程。</em></p>
<p>delete():<br>Implement this to handle requests to delete one or more rows. The implementation should apply the selection clause when performing deletion, allowing the operation to affect multiple rows in a directory. As a courtesy, call notifyChange() after deleting.<br><em>注意: 这方法有可能用于多线程。如果一个特定的行要被删除，它会在URI的末尾解析出这一行的ID。</em></p>
<p>update():<br>Implement this to handle requests to update one or more rows. The implementation should update all rows matching the selection to set the columns according to the provided values map. As a courtesy, call notifyChange() after updating.<br><em>注意: 这方法有可能用于多线程。</em></p>
<p>sqlhelper.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlHelper</span> <span class="keyword">extends</span> <span class="title">SQLiteOpenHelper</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CREATE_BOOK = <span class="string">"create table Book ("</span></div><div class="line">            + <span class="string">"id integer primary key autoincrement, "</span></div><div class="line">            + <span class="string">"author text, "</span></div><div class="line">            + <span class="string">"price real, "</span></div><div class="line">            + <span class="string">"pages integer, "</span></div><div class="line">            + <span class="string">"name text)"</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CREATE_CATEGORY = <span class="string">"create table Category ("</span></div><div class="line">            + <span class="string">"id integer primary key autoincrement, "</span></div><div class="line">            + <span class="string">"category_name text)"</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SqlHelper</span><span class="params">(Context context, String name, SQLiteDatabase.CursorFactory factory, <span class="keyword">int</span> version)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, name, factory, version);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(SQLiteDatabase db)</span> </span>&#123;</div><div class="line">        db.execSQL(CREATE_BOOK);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onUpgrade</span><span class="params">(SQLiteDatabase db, <span class="keyword">int</span> oldVersion, <span class="keyword">int</span> newVersion)</span> </span>&#123;</div><div class="line">        db.execSQL(<span class="string">"drop table if exists Book"</span>);</div><div class="line">        onCreate(db);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>客户端：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Uri uri = Uri.parse(<span class="string">"content://com.unknow.jason.testdatabaseex.provider/book"</span>);</div><div class="line">Cursor cursor = getContentResolver().query(uri, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span> (cursor != <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="keyword">while</span> (cursor.moveToNext()) &#123;</div><div class="line">        String name = cursor.getString(cursor.getColumnIndex(<span class="string">"name"</span>));</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>浅析：<br>getContentResolver().query():<br>Query the given URI, returning a Cursor over the result set with optional support for cancellation.<br><em>为了更佳的性能，调用者应该遵循两点：<br>1、提供一个明确的projection，防止从存储中读取不需要的数据。<br>2、使用问号参数标记，如“电话=？”而不是在选择参数中的显式值，因此，不同的值的查询将被确认为缓存的目的相同的。</em></p>

    
  </div>
</article>

</div>





  <a id="backTop" class="back-top">
    <i class="icon-angle-up"></i>
  </a>




  <div class="modal" id="modal">
  <span id="cover" class="cover hide"></span>
  <div id="modal-dialog" class="modal-dialog hide-dialog">
    <div class="modal-header">
      <span id="close" class="btn-close">Close</span>
    </div>
    <hr>
    <div class="modal-body">
      <ul class="list-toolbox">
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/archives/"
              rel="noopener noreferrer"
              target="_self"
              >
              Blog
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/tags/"
              rel="noopener noreferrer"
              target="_self"
              >
              Tag
            </a>
          </li>
        
          <li class="item-toolbox">
            <a
              class="CIRCLE"
              href="/about/"
              rel="noopener noreferrer"
              target="_self"
              >
              About
            </a>
          </li>
        
      </ul>

    </div>
  </div>
</div>



  
      <div class="fexo-comments comments-post">
    
  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'forsigner';
    
    var disqus_url = 'http://yoursite.com/2015/10/15/Android-浅析-ContentProvider-一-使用/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//forsigner.disqus.com/count.js" async></script>



    




  </div>

  

  <script type="text/javascript">
  function loadScript(url, callback) {
    var script = document.createElement('script')
    script.type = 'text/javascript';

    if (script.readyState) { //IE
      script.onreadystatechange = function() {
        if (script.readyState == 'loaded' ||
          script.readyState == 'complete') {
          script.onreadystatechange = null;
          callback();
        }
      };
    } else { //Others
      script.onload = function() {
        callback();
      };
    }

    script.src = url;
    document.getElementsByTagName('head')[0].appendChild(script);
  }

  window.onload = function() {
    loadScript('/js/bundle.js?235683', function() {
      // load success
    });
  }
</script>

</body>
</html>

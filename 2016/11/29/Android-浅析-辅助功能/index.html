<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.useso.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Android,辅助功能," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="目前 Android 的权限收紧越来越厉害，对于一个需要提供很多功能的应用来说，让用户手动点击这么多权限框是很烦的，那么就需要辅助功能来帮助我们点击了，嘿嘿嘿。">
<meta property="og:type" content="article">
<meta property="og:title" content="Android 浅析 辅助功能">
<meta property="og:url" content="http://yoursite.com/2016/11/29/Android-浅析-辅助功能/index.html">
<meta property="og:site_name" content="Zhong's_blog">
<meta property="og:description" content="目前 Android 的权限收紧越来越厉害，对于一个需要提供很多功能的应用来说，让用户手动点击这么多权限框是很烦的，那么就需要辅助功能来帮助我们点击了，嘿嘿嘿。">
<meta property="og:updated_time" content="2016-12-15T12:47:06.453Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android 浅析 辅助功能">
<meta name="twitter:description" content="目前 Android 的权限收紧越来越厉害，对于一个需要提供很多功能的应用来说，让用户手动点击这么多权限框是很烦的，那么就需要辅助功能来帮助我们点击了，嘿嘿嘿。">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2016/11/29/Android-浅析-辅助功能/"/>

  <title> Android 浅析 辅助功能 | Zhong's_blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d18587c6291210ec4a8ce3d8868a3df9";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Zhong's_blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Read The Funning Source Code</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Android 浅析 辅助功能
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-11-29T21:41:50+08:00" content="2016-11-29">
              2016-11-29
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/11/29/Android-浅析-辅助功能/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/11/29/Android-浅析-辅助功能/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>Linus Benedict Torvalds : RTFSC – Read The Funning Source Code</p>
</blockquote>
<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>许多Android用户有不同的需求，需要他们以不同的方式与他们的Android设备进行交互。这些包括具有视觉，身体或年龄相关限制的用户，这些限制阻止他们完全看到或使用触摸屏，以及听力损失的用户可能无法感知到可听信息和警报。 Android提供了辅助功能和服务，可帮助这些用户更轻松地浏览其设备，包括文字转语音，触觉反馈，手势导航，轨迹球和方向键盘导航。 Android应用程序开发人员可以利用这些服务来使他们的应用程序更容易访问。 Android开发人员还可以构建自己的辅助功能服务，可以提供增强的可用性功能，如音频提示，物理反馈和其他导航模式。辅助功能服务可以为所有应用程序，一组应用程序或单个应用程序提供这些增强功能。</p>
</blockquote>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="Step-1-AccessibilityService类"><a href="#Step-1-AccessibilityService类" class="headerlink" title="Step 1 : AccessibilityService类"></a>Step 1 : AccessibilityService类</h3><p>自定义一个<code>Service</code>然后继承<code>AccessibilityService</code>类。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;service</div><div class="line">    android:name=".permission.PermissionAccessibilityService"</div><div class="line">    android:enabled="true"</div><div class="line">    android:exported="true"</div><div class="line">    android:permission="android.permission.BIND_ACCESSIBILITY_SERVICE"</div><div class="line">    android:process=":DefendService"&gt;</div><div class="line">    &lt;intent-filter&gt;</div><div class="line">        &lt;action android:name="android.accessibilityservice.AccessibilityService" /&gt;</div><div class="line">    &lt;/intent-filter&gt;</div><div class="line">    &lt;meta-data</div><div class="line">        android:name="android.accessibilityservice"</div><div class="line">        android:resource="@xml/accessibility_service_config"/&gt;</div><div class="line">&lt;/service&gt;</div></pre></td></tr></table></figure></p>
<h3 id="Step-2-accessibility-service-config-xml"><a href="#Step-2-accessibility-service-config-xml" class="headerlink" title="Step 2 : accessibility_service_config.xml"></a>Step 2 : accessibility_service_config.xml</h3><p>创建一个作为辅助功能开启说明类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;accessibility-service</div><div class="line">    xmlns:android=<span class="string">"http://schemas.android.com/apk/res/android"</span></div><div class="line">    android:accessibilityEventTypes=<span class="string">"typeAllMask"</span></div><div class="line">    android:accessibilityFeedbackType=<span class="string">"feedbackGeneric"</span></div><div class="line">    android:accessibilityFlags=<span class="string">""</span></div><div class="line">    android:canRetrieveWindowContent=<span class="string">"true"</span></div><div class="line">    android:description=<span class="string">"@string/accessibility_perm_tutorial_message"</span></div><div class="line">    android:notificationTimeout=<span class="string">"100"</span>/&gt;</div></pre></td></tr></table></figure></p>
<p>几个属性说明：</p>
<ol>
<li>android:accessibilityEventTypes=”typeAllMask”<br>这个是用来设置响应事件的类型，typeAllMask 是响应所有类型的事件了。还有单击、长按、滑动等。</li>
<li>android:accessibilityFeedbackType=”feedbackSpoken”<br>设置回馈给用户的方式，有语音播出和振动。可以配置一些TTS引擎，让它实现发音。</li>
<li>android:notificationTimeout=”100”<br>响应时间的设置。</li>
<li>android:packageNames=”com.example.android.apis”<br>可以指定响应某个应用的事件，这里因为要响应所有应用的事件，所以不填，默认就是响应所有应用的事件。比如我们写一个微信抢红包的辅助程序，就可以在这里填写微信的包名，便可以监听微信产生的事件了。</li>
</ol>
<h3 id="Step-3-onAccessibilityEvent-AccessibilityEvent-event"><a href="#Step-3-onAccessibilityEvent-AccessibilityEvent-event" class="headerlink" title="Step 3 : onAccessibilityEvent(AccessibilityEvent event)"></a>Step 3 : onAccessibilityEvent(AccessibilityEvent event)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span>  </div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAccessibilityEvent</span><span class="params">(AccessibilityEvent event)</span> </span>&#123;  </div><div class="line">    <span class="keyword">int</span> eventType = event.getEventType();  </div><div class="line">    <span class="keyword">switch</span> (eventType) &#123;  </div><div class="line">    <span class="keyword">case</span> AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED:  </div><div class="line">        <span class="comment">//.......  </span></div><div class="line">    &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过在<code>event.getEventType()</code>方法里可以筛选出不同的事件：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Deprecated</span>  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_TEXT_LENGTH = <span class="number">500</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of clicking on a &#123;<span class="doctag">@link</span> android.view.View&#125; like </div><div class="line"> * &#123;<span class="doctag">@link</span> android.widget.Button&#125;, &#123;<span class="doctag">@link</span> android.widget.CompoundButton&#125;, etc. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_CLICKED = <span class="number">0x00000001</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of long clicking on a &#123;<span class="doctag">@link</span> android.view.View&#125; like </div><div class="line"> * &#123;<span class="doctag">@link</span> android.widget.Button&#125;, &#123;<span class="doctag">@link</span> android.widget.CompoundButton&#125;, etc. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_LONG_CLICKED = <span class="number">0x00000002</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of selecting an item usually in the context of an </div><div class="line"> * &#123;<span class="doctag">@link</span> android.widget.AdapterView&#125;. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_SELECTED = <span class="number">0x00000004</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of setting input focus of a &#123;<span class="doctag">@link</span> android.view.View&#125;. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_FOCUSED = <span class="number">0x00000008</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of changing the text of an &#123;<span class="doctag">@link</span> android.widget.EditText&#125;. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_TEXT_CHANGED = <span class="number">0x00000010</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of opening a &#123;<span class="doctag">@link</span> android.widget.PopupWindow&#125;, </div><div class="line"> * &#123;<span class="doctag">@link</span> android.view.Menu&#125;, &#123;<span class="doctag">@link</span> android.app.Dialog&#125;, etc. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_WINDOW_STATE_CHANGED = <span class="number">0x00000020</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event showing a &#123;<span class="doctag">@link</span> android.app.Notification&#125;. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_NOTIFICATION_STATE_CHANGED = <span class="number">0x00000040</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of a hover enter over a &#123;<span class="doctag">@link</span> android.view.View&#125;. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_HOVER_ENTER = <span class="number">0x00000080</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of a hover exit over a &#123;<span class="doctag">@link</span> android.view.View&#125;. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_HOVER_EXIT = <span class="number">0x00000100</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of starting a touch exploration gesture. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_TOUCH_EXPLORATION_GESTURE_START = <span class="number">0x00000200</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of ending a touch exploration gesture. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_TOUCH_EXPLORATION_GESTURE_END = <span class="number">0x00000400</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of changing the content of a window and more </div><div class="line"> * specifically the sub-tree rooted at the event's source. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_WINDOW_CONTENT_CHANGED = <span class="number">0x00000800</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of scrolling a view. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_SCROLLED = <span class="number">0x00001000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of changing the selection in an &#123;<span class="doctag">@link</span> android.widget.EditText&#125;. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_TEXT_SELECTION_CHANGED = <span class="number">0x00002000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of an application making an announcement. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_ANNOUNCEMENT = <span class="number">0x00004000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of gaining accessibility focus. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_ACCESSIBILITY_FOCUSED = <span class="number">0x00008000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of clearing accessibility focus. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_ACCESSIBILITY_FOCUS_CLEARED = <span class="number">0x00010000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of traversing the text of a view at a given movement granularity. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_VIEW_TEXT_TRAVERSED_AT_MOVEMENT_GRANULARITY = <span class="number">0x00020000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of beginning gesture detection. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_GESTURE_DETECTION_START = <span class="number">0x00040000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of ending gesture detection. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_GESTURE_DETECTION_END = <span class="number">0x00080000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of the user starting to touch the screen. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_TOUCH_INTERACTION_START = <span class="number">0x00100000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Represents the event of the user ending to touch the screen. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TYPE_TOUCH_INTERACTION_END = <span class="number">0x00200000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Change type for &#123;<span class="doctag">@link</span> #TYPE_WINDOW_CONTENT_CHANGED&#125; event: </div><div class="line"> * The type of change is not defined. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONTENT_CHANGE_TYPE_UNDEFINED = <span class="number">0x00000000</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Change type for &#123;<span class="doctag">@link</span> #TYPE_WINDOW_CONTENT_CHANGED&#125; event: </div><div class="line"> * A node in the subtree rooted at the source node was added or removed. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONTENT_CHANGE_TYPE_SUBTREE = <span class="number">0x00000001</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Change type for &#123;<span class="doctag">@link</span> #TYPE_WINDOW_CONTENT_CHANGED&#125; event: </div><div class="line"> * The node's text changed. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONTENT_CHANGE_TYPE_TEXT = <span class="number">0x00000002</span>;  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * Change type for &#123;<span class="doctag">@link</span> #TYPE_WINDOW_CONTENT_CHANGED&#125; event: </div><div class="line"> * The node's content description changed. </div><div class="line"> */  </div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> CONTENT_CHANGE_TYPE_CONTENT_DESCRIPTION = <span class="number">0x00000004</span>;</div></pre></td></tr></table></figure></p>
<p>通过这个事件我们可以区分不同的事件做区分了。</p>
<h2 id="Step-4-查找元素"><a href="#Step-4-查找元素" class="headerlink" title="Step 4 : 查找元素"></a>Step 4 : 查找元素</h2><p>这里有两种方法可以查找到相应元素：</p>
<ol>
<li>通过节点View的Text内容来查找<code>findAccessibilityNodeInfosByText(&quot;查找内容&quot;)</code>，这种方式查找，就是像TextView、Button等View有文本内容的，可以使用这种方式快速的找到。</li>
<li>通过节点View在xml布局中的id名称<code>findAccessibilityNodeInfosByViewId(&quot;@id/xxx&quot;)</code>，这个一般很难知道，但是在查找系统控件的时候还是可以做的，因为系统的控件的id是可以知道的，而且是统一的。</li>
</ol>
<h2 id="Step-5-点击元素"><a href="#Step-5-点击元素" class="headerlink" title="Step 5 : 点击元素"></a>Step 5 : 点击元素</h2><p>找到想要的View节点，调用方法模拟事件：</p>
<ol>
<li>点击事件：performAction(AccessibilityNodeInfo.ACTION_CLICK)</li>
<li>滑动时间：performAction(AccessibilityNodeInfo.ACTION_SCROLL_FORWARD)</li>
<li>物理键：AccessibilityService.performGlobalAction(AccessibilityService.GLOBAL_ACTION_BACK);<br>…</li>
</ol>
<h2 id="判断是否开启辅助功能"><a href="#判断是否开启辅助功能" class="headerlink" title="判断是否开启辅助功能"></a>判断是否开启辅助功能</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isAccessibilitySettingsOn</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (context == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> accessibilityEnabled = <span class="number">0</span>;</div><div class="line">    <span class="keyword">try</span> &#123;</div><div class="line">        accessibilityEnabled = Settings.Secure.getInt(context.getApplicationContext().getContentResolver(), Settings.Secure.ACCESSIBILITY_ENABLED);</div><div class="line">    &#125; <span class="keyword">catch</span> (Settings.SettingNotFoundException e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">    String packageName = context.getPackageName();</div><div class="line">    <span class="comment">// 获取注册服务的那个类的全包名</span></div><div class="line">    String accessibilityServicePath = <span class="string">".permission.PermissionAccessibilityService"</span>;</div><div class="line">    String serviceStr = packageName + <span class="string">"/"</span> + accessibilityServicePath;</div><div class="line">    <span class="keyword">if</span> (accessibilityEnabled != ACCESSIBILITY_ENABLED) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    String settingValue = Settings.Secure.getString(context.getApplicationContext().getContentResolver(), Settings.Secure.ENABLED_ACCESSIBILITY_SERVICES);</div><div class="line">    <span class="keyword">if</span> (settingValue == <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div><div class="line">    TextUtils.SimpleStringSplitter splitter = <span class="keyword">new</span> TextUtils.SimpleStringSplitter(<span class="string">':'</span>);</div><div class="line">    splitter.setString(settingValue);</div><div class="line">    <span class="keyword">while</span> (splitter.hasNext()) &#123;</div><div class="line">        String accessabilityService = splitter.next();</div><div class="line">        <span class="keyword">if</span> (accessabilityService.equalsIgnoreCase(serviceStr)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="附录-跳转到系统界面activity"><a href="#附录-跳转到系统界面activity" class="headerlink" title="附录 跳转到系统界面activity"></a>附录 跳转到系统界面activity</h2><table>
<thead>
<tr>
<th style="text-align:left">String</th>
<th style="text-align:left">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ACTION_ACCESSIBILITY_SETTINGS</td>
<td style="text-align:left">辅助功能模块的显示设置。</td>
</tr>
<tr>
<td style="text-align:left">ACTION_ADD_ACCOUNT</td>
<td style="text-align:left">显示屏幕上创建一个新帐户添加帐户。</td>
</tr>
<tr>
<td style="text-align:left">ACTION_AIRPLANE_MODE_SETTINGS</td>
<td style="text-align:left">显示设置，以允许进入/退出飞行模式。</td>
</tr>
<tr>
<td style="text-align:left">ACTION_APN_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置的APN。</td>
</tr>
<tr>
<td style="text-align:left">ACTION_APPLICATION_DETAILS_SETTINGS</td>
<td style="text-align:left">有关特定应用程序的详细信息的显示屏幕。</td>
</tr>
<tr>
<td style="text-align:left">ACTION_APPLICATION_DEVELOPMENT_SETTINGS</td>
<td style="text-align:left">显示设置，以允许应用程序开发相关的设置配置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_APPLICATION_SETTINGS</td>
<td style="text-align:left">显示设置，以允许应用程序相关的设置配置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_BLUETOOTH_SETTINGS</td>
<td style="text-align:left">显示设置，以允许蓝牙配置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_DATA_ROAMING_SETTINGS</td>
<td style="text-align:left">选择of2G/3G显示设置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_DATE_SETTINGS</td>
<td style="text-align:left">显示日期和时间设置，以允许配 置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_DEVICE_INFO_SETTINGS</td>
<td style="text-align:left">显示一般的设备信息设置（序列号，软件版本，电话号码，等）</td>
</tr>
<tr>
<td style="text-align:left">ACTION_DISPLAY_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置显示</td>
</tr>
<tr>
<td style="text-align:left">ACTION_INPUT_METHOD_SETTINGS</td>
<td style="text-align:left">特别配置的输入方法，允许用户启用输入法的显示设置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_INPUT_METHOD_SUBTYPE_SETTINGS</td>
<td style="text-align:left">显示设置来启用/禁用输入法亚型</td>
</tr>
<tr>
<td style="text-align:left">ACTION_INTERNAL_STORAGE_SETTINGS</td>
<td style="text-align:left">内部存储的显示设置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_LOCALE_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置的语言环境</td>
</tr>
<tr>
<td style="text-align:left">ACTION_LOCATION_SOURCE_SETTINGS</td>
<td style="text-align:left">显示设置，以允许当前位置源的配置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_MANAGE_ALL_APPLICATIONS_SETTINGS</td>
<td style="text-align:left">显示设置来管理所有的应用程序</td>
</tr>
<tr>
<td style="text-align:left">ACTION_MANAGE_APPLICATIONS_SETTINGS</td>
<td style="text-align:left">显示设置来管理安装的应用程序</td>
</tr>
<tr>
<td style="text-align:left">ACTION_MEMORY_CARD_SETTINGS</td>
<td style="text-align:left">显示设置为存储卡存储</td>
</tr>
<tr>
<td style="text-align:left">ACTION_NETWORK_OPERATOR_SETTINGS</td>
<td style="text-align:left">选择网络运营商的显示设置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_PRIVACY_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置隐私选项</td>
</tr>
<tr>
<td style="text-align:left">ACTION_QUICK_LAUNCH_SETTINGS</td>
<td style="text-align:left">显示设置，以允许快速启动快捷键的配置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_SEARCH_SETTINGS</td>
<td style="text-align:left">全局搜索显示设置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_SECURITY_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置的安全性和位置隐私</td>
</tr>
<tr>
<td style="text-align:left">ACTION_SETTINGS</td>
<td style="text-align:left">显示系统设置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_SOUND_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置声音和音量</td>
</tr>
<tr>
<td style="text-align:left">ACTION_SYNC_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置同步设置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_USER_DICTIONARY_SETTINGS</td>
<td style="text-align:left">显示设置来管理用户输入字典</td>
</tr>
<tr>
<td style="text-align:left">ACTION_WIFI_IP_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置一个静态IP地址的Wi – Fi</td>
</tr>
<tr>
<td style="text-align:left">ACTION_WIFI_SETTINGS</td>
<td style="text-align:left">显示设置，以允许Wi – Fi配置</td>
</tr>
<tr>
<td style="text-align:left">ACTION_WIRELESS_SETTINGS</td>
<td style="text-align:left">显示设置，以允许配 置，如Wi – Fi，蓝牙和移动网络的无线控制</td>
</tr>
<tr>
<td style="text-align:left">AUTHORITY</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">EXTRA_AUTHORITIES</td>
<td style="text-align:left">在推出活动的基础上给予的权力限制可选项。</td>
</tr>
<tr>
<td style="text-align:left">EXTRA_INPUT_METHOD_ID</td>
</tr>
</tbody>
</table>
<h2 id="彩蛋"><a href="#彩蛋" class="headerlink" title="彩蛋"></a>彩蛋</h2><ol>
<li>如果遇到action无效的情况，例如上滑无效，可以将里面的所有listview元素都滑动一遍，因为有可能是做了fragment，第一次的滑动滑到了下面的层级去了。</li>
</ol>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag">#Android</a>
          
            <a href="/tags/辅助功能/" rel="tag">#辅助功能</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/11/29/设计模式-责任链模式/" rel="next" title="设计模式-责任链模式">
                <i class="fa fa-chevron-left"></i> 设计模式-责任链模式
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/12/02/设计模式-解释器模式/" rel="prev" title="设计模式-解释器模式">
                设计模式-解释器模式 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/11/29/Android-浅析-辅助功能/"
           data-title="Android 浅析 辅助功能" data-url="http://yoursite.com/2016/11/29/Android-浅析-辅助功能/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="钟华健" />
          <p class="site-author-name" itemprop="name">钟华健</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">37</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/jasonzhong" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">2.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用"><span class="nav-number">3.</span> <span class="nav-text">使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-1-AccessibilityService类"><span class="nav-number">3.1.</span> <span class="nav-text">Step 1 : AccessibilityService类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-2-accessibility-service-config-xml"><span class="nav-number">3.2.</span> <span class="nav-text">Step 2 : accessibility_service_config.xml</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Step-3-onAccessibilityEvent-AccessibilityEvent-event"><span class="nav-number">3.3.</span> <span class="nav-text">Step 3 : onAccessibilityEvent(AccessibilityEvent event)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-4-查找元素"><span class="nav-number">4.</span> <span class="nav-text">Step 4 : 查找元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-5-点击元素"><span class="nav-number">5.</span> <span class="nav-text">Step 5 : 点击元素</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#判断是否开启辅助功能"><span class="nav-number">6.</span> <span class="nav-text">判断是否开启辅助功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#附录-跳转到系统界面activity"><span class="nav-number">7.</span> <span class="nav-text">附录 跳转到系统界面activity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#彩蛋"><span class="nav-number">8.</span> <span class="nav-text">彩蛋</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">钟华健</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jasonzhong"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  

  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
